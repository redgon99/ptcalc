<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>소방공무원 체력검정 계산표</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Malgun Gothic", "맑은 고딕", sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }

      .table-container {
        width: 100%;
        max-height: 95vh;
        overflow-y: auto;
        position: relative;
        z-index: 1;
        border: 1px solid #000;
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 14px;
        table-layout: auto;
      }

      thead {
        position: sticky;
        top: 0;
        z-index: 2;
        background-color: white;
      }

      /* 첫 번째 행(헤더) 고정 */
      thead tr:first-child {
        position: sticky;
        top: 0;
        z-index: 3;
        background-color: white;
      }

      /* 두 번째 행(생년월일 등 컨트롤) 고정 */
      thead tr:nth-child(2) {
        position: sticky;
        top: 28px;
        z-index: 3;
        max-height: 200px;
        background-color: white;
      }

      /* 세 번째 행(측정 점수 헤더) 고정 */
      thead tr:nth-child(3) {
        position: sticky;
        top: 56px;
        z-index: 3;
        background-color: white;
      }

      /* 네 번째 행(점수 숫자) 고정 */
      thead tr:nth-child(4) {
        position: sticky;
        top: 84px;
        z-index: 3;
        background-color: white;
      }

      /* 테이블 헤더 스타일 */
      thead tr th,
      thead tr td {
        border: 1px solid #000;
        background-color: white;
      }

      /* 헤더 셀 테두리 보강 */
      thead tr td::after,
      thead tr th::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background-color: #000;
        z-index: 1;
      }

      /* 좌우 테두리 보강 */
      thead tr td::before,
      thead tr th::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 1px;
        height: 100%;
        background-color: #000;
        z-index: 1;
      }

      /* 모든 테이블 셀 테두리 통일 */
      table,
      th,
      td {
        border: 1px solid #000;
      }

      /* 셀 내부 여백 및 높이 통일 */
      th,
      td {
        padding: 4px;
        text-align: center;
        height: 28px;
        background-clip: padding-box;
        position: relative;
      }

      /* 스크롤 시 셀 테두리가 보이도록 배경 설정 */
      tbody tr:nth-child(even) td {
        background-color: #ffffff;
      }

      tbody tr:nth-child(odd) td {
        background-color: #ffffff;
      }

      .header {
        background-color: #367c2b;
        color: white;
        text-align: center;
        font-weight: bold;
        padding: 8px;
        font-size: 18px;
      }

      .gray-bg {
        background-color: #f0f0f0;
      }

      .green-bg {
        background-color: #367c2b;
        color: white;
      }

      .yellow-bg {
        background-color: #ffeb3b;
        font-weight: bold;
        font-size: 16px;
        vertical-align: middle;
        text-align: center;
      }

      .light-yellow-bg {
        background-color: #fff9c4;
        font-size: 18px;
        font-weight: bold;
        vertical-align: middle;
      }

      .light-green-bg {
        background-color: #e8f5e9;
      }

      .left-align {
        text-align: left;
        padding-left: 8px;
      }

      .blue-text {
        color: #367c2b;
        font-weight: bold;
      }

      select {
        width: 100%;
        padding: 2px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      .reset-btn {
        padding: 4px;
        margin: 0;
        background-color: #367c2b;
        color: white;
        border: none;
        border-radius: 3px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        font-size: 12px;
        height: 100%;
        min-height: 28px;
        line-height: 0.9;
      }

      .temp-save-btn {
        padding: 4px;
        margin: 0;
        background-color: #2196f3;
        color: white;
        border: none;
        border-radius: 3px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        font-size: 12px;
        height: 100%;
        min-height: 28px;
        line-height: 0.9;
      }

      .qr-btn {
        padding: 4px;
        margin: 0;
        background-color: #9c27b0;
        color: white;
        border: none;
        border-radius: 3px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        font-size: 12px;
        height: 100%;
        min-height: 28px;
        line-height: 0.9;
      }

      .qr-modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .qr-modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 5px;
        width: 300px;
        text-align: center;
      }

      .qr-close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .qr-close:hover {
        color: black;
      }

      .narrow-col {
        width: 40px;
      }

      .score-box {
        width: 40px;
        height: 28px;
      }

      .compact-cell {
        padding: 1px;
        font-size: 11px;
        line-height: 0.9;
      }

      .age-row {
        height: 24px;
      }

      .gender-cell {
        cursor: pointer;
      }

      .gender-cell.selected {
        font-weight: bold;
        background-color: #e8f5e9;
      }

      .gender-option {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }

      .gender-radio {
        margin: 0;
      }

      .gender-label {
        margin: 0;
        font-size: 14px;
      }

      /* 배점 셀 스타일 */
      .score-cell {
        cursor: pointer;
        padding: 2px;
        font-size: 12px;
        line-height: 1;
        height: auto;
        min-height: 28px;
        white-space: pre-line;
        border: 1px solid #000;
      }

      .score-cell:hover {
        background-color: #8db397;
      }

      .score-cell.selected {
        background-color: #c8e6c9;
        font-weight: bold;
      }

      /* 비활성화된 셀 스타일 */
      .score-cell.inactive {
        background-color: #f0f0f0;
        cursor: default;
        color: #888;
      }

      /* 성별에 따른 득점 표시 */
      .score-display {
        transition: background-color 0.3s;
      }

      .score-display.inactive {
        background-color: #f0f0f0;
        color: #888;
      }

      /* 배점 자동 줄바꿈 스타일 */
      .range-text {
        display: block;
        line-height: 0.9;
      }

      /* 종목명 열 너비 고정 */
      td.left-align.gray-bg {
        width: 100px;
        min-width: 50px;
        max-width: 90px;
        word-break: keep-all;
        padding: 3px 5px;
        white-space: normal;
        vertical-align: middle;
      }

      /* 성별 열 너비 고정 */
      tr td:nth-child(2):not([colspan]) {
        width: 50px !important;
        min-width: 30px !important;
        max-width: 50px !important;
        text-align: center;
        vertical-align: middle;
        padding: 2px;
      }

      /* 성별이 rowspan인 경우 */
      tr td[rowspan]:nth-child(2) {
        width: 30px !important;
        min-width: 30px !important;
        max-width: 30px !important;
        text-align: center;
        vertical-align: middle;
        padding: 2px;
      }

      /* 측정점수 셀 너비 설정 */
      .score-cell {
        min-width: 40px;
        width: auto;
        max-width: none;
        box-sizing: border-box;
      }

      /* 왕복오래달리기 셀 조정 */
      .narrow-col.score-cell {
        min-width: 40px;
        width: auto;
      }

      /* 점수 헤더 셀 설정 */
      tr:nth-child(3) td.gray-bg,
      tr:nth-child(4) td.gray-bg {
        min-width: 40px;
        width: auto;
        max-width: none;
      }

      /* 측정 점수 열 그룹 너비 */
      td[colspan="10"].gray-bg {
        width: auto;
      }

      .confirm-btn {
        padding: 4px;
        margin: 0;
        background-color: #555555;
        color: white;
        border: none;
        border-radius: 3px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        font-size: 12px;
        height: 100%;
        min-height: 28px;
        line-height: 0.9;
      }

      .confirm-btn.active {
        background-color: #367c2b;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }

      .bold-text {
        font-weight: bold;
      }

      #total-score {
        text-align: center;
      }

      /* 기록 입력 필드 스타일 */
      .score-input {
        min-width: 30px;
        max-width: 50px; /* 입력 필드 너비 */
        padding: 2px;
        text-align: right;
        border: 1px solid #ccc;
        border-radius: 3px;
        font-size: 14px;
      }

      /* 입력 필드 포커스 스타일 */
      .score-input:focus {
        outline: none;
        border-color: #367c2b;
        box-shadow: 0 0 3px rgba(54, 124, 43, 0.5);
      }

      /* 비활성화된 입력 필드 스타일 */
      .score-input.inactive-input {
        background-color: #f0f0f0;
        color: #888;
        cursor: default;
      }

      /* 비활성화된 성별/기록 TD 스타일 */
      .inactive-td {
        background-color: #f0f0f0 !important; /* 기존 inactive 스타일과 통일 */
        color: #aaa; /* 비활성 텍스트 색상 */
      }
    </style>
  </head>
  <body>
    <div class="table-container">
      <table>
        <thead>
          <!-- 헤더 -->
          <tr>
            <td colspan="15" class="header">소방공무원 체력검정 계산표</td>
          </tr>

          <!-- 생년월일 행 -->
          <tr>
            <td class="left-align gray-bg">생년</td>
            <td class="compact-cell" colspan="2">
              <select id="birth-year">
                <option value="1968">1968</option>
                <option value="1969">1969</option>
                <option value="1970">1970</option>
                <option value="1971">1971</option>
                <option value="1972">1972</option>
                <option value="1973">1973</option>
                <option value="1974">1974</option>
                <option value="1975">1975</option>
                <option value="1976">1976</option>
                <option value="1977">1977</option>
                <option value="1978">1978</option>
                <option value="1979">1979</option>
                <option value="1980">1980</option>
                <option value="1981">1981</option>
                <option value="1982">1982</option>
                <option value="1983">1983</option>
                <option value="1984">1984</option>
                <option value="1985">1985</option>
                <option value="" selected>선택</option>
                <option value="1986">1986</option>
                <option value="1987">1987</option>
                <option value="1988">1988</option>
                <option value="1989">1989</option>
                <option value="1990">1990</option>
                <option value="1991">1991</option>
                <option value="1992">1992</option>
                <option value="1993">1993</option>
                <option value="1994">1994</option>
                <option value="1995">1995</option>
                <option value="1996">1996</option>
                <option value="1997">1997</option>
                <option value="1998">1998</option>
                <option value="1999">1999</option>
                <option value="2000">2000</option>
                <option value="2001">2001</option>
                <option value="2002">2002</option>
                <option value="2003">2003</option>
                <option value="2004">2004</option>
              </select>
            </td>
            <td>
              <button id="birth-confirm-btn" class="confirm-btn">
                생년<br />확인
              </button>
            </td>
            <td class="blue-text" id="age-display"></td>
            <td class="gray-bg" colspan="3">
              성별
              <div
                class="gender-option"
                style="display: inline-flex; margin-left: 10px"
              >
                <input
                  type="radio"
                  id="gender-male"
                  name="gender"
                  value="male"
                  class="gender-radio"
                  checked
                />
                <label for="gender-male" class="gender-label">남</label>
                <input
                  type="radio"
                  id="gender-female"
                  name="gender"
                  value="female"
                  class="gender-radio"
                />
                <label for="gender-female" class="gender-label">여</label>
              </div>
            </td>
            <td>
              <button id="qr-btn" class="qr-btn">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  width="80%"
                  height="80%"
                  fill="white"
                >
                  <path
                    d="M3,3h6v6H3V3z M5,5v2h2V5H5z M11,3h2v2h-2V3z M15,3h6v6h-6V3z M17,5v2h2V5H17z M3,11h2v2H3V11z M11,11h2v2h-2V11z M13,13h2v2h-2V13z M15,11h2v2h-2V11z M17,13h2v2h-2V13z M19,15h2v2h-2V15z M3,15h6v6H3V15z M5,17v2h2v-2H5z M11,15h2v2h-2V15z M19,11h2v2h-2V11z M15,15h2v2h-2V15z M15,19h6v2h-6V19z"
                  />
                </svg>
              </button>
            </td>
            <td>
              <button id="reset-btn" class="reset-btn">
                <i class="fa fa-refresh fa-lg"></i>
              </button>
            </td>
            <td class="yellow-bg" style="padding: 2px 5px">
              <div
                style="font-size: 16px; font-weight: bold; letter-spacing: -1px"
              >
                총점
              </div>
            </td>
            <td class="light-yellow-bg" id="total-score">
              <div
                style="font-size: 16px; font-weight: bold"
                id="total-score-value"
              >
                0
              </div>
            </td>
            <td class="yellow-bg" style="padding: 2px 5px">
              <div
                style="font-size: 16px; font-weight: bold; letter-spacing: -1px"
              >
                환산점
              </div>
            </td>
            <td class="light-yellow-bg">
              <div
                style="font-size: 16px; font-weight: bold"
                id="conversion-score-value"
              ></div>
            </td>
          </tr>

          <!-- 측정 점수 헤더 행 -->
          <tr>
            <td rowspan="2"></td>
            <td rowspan="2" class="gray-bg">성별</td>
            <td rowspan="2" class="gray-bg">기록</td>
            <td colspan="10" class="gray-bg">측정 점수</td>
            <td rowspan="2" class="gray-bg">득점</td>
          </tr>
          <tr>
            <td class="gray-bg">1</td>
            <td class="gray-bg">2</td>
            <td class="gray-bg">3</td>
            <td class="gray-bg">4</td>
            <td class="gray-bg">5</td>
            <td class="gray-bg">6</td>
            <td class="gray-bg">7</td>
            <td class="gray-bg">8</td>
            <td class="gray-bg">9</td>
            <td class="gray-bg">10</td>
          </tr>
        </thead>
        <tbody>
          <!-- 악력 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">악력<br />(kg)</td>
            <td data-gender="male">남</td>
            <td data-gender="male">
              <input
                type="number"
                class="score-input"
                id="weight-male-input"
                step="0.1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="1"
            >
              34.0 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="2"
            >
              34.1~36.8
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="3"
            >
              36.9~39.6
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="4"
            >
              39.7~42.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="5"
            >
              42.5~45.2
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="6"
            >
              45.3~49.2
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="7"
            >
              49.3~52.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="8"
            >
              52.5~55.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="9"
            >
              55.5~58.0
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="male"
              data-score="10"
            >
              58.1 이상
            </td>
            <td class="light-green-bg score-display" id="weight-male-score">
              0
            </td>
          </tr>
          <tr>
            <td data-gender="female">여</td>
            <td data-gender="female">
              <input
                type="number"
                class="score-input"
                id="weight-female-input"
                step="0.1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="1"
            >
              20.6 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="2"
            >
              20.7~22.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="3"
            >
              22.4~24.0
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="4"
            >
              24.1~25.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="5"
            >
              25.8~27.5
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="6"
            >
              27.6~29.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="7"
            >
              29.8~31.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="8"
            >
              31.8~33.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="9"
            >
              33.8~35.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="weight"
              data-gender="female"
              data-score="10"
            >
              35.8 이상
            </td>
            <td class="light-green-bg" id="weight-female-score">0</td>
          </tr>

          <!-- 배근력 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">배근력<br />(kg)</td>
            <td data-gender="male">남</td>
            <td data-gender="male">
              <input
                type="number"
                class="score-input"
                id="deadlift-male-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="1"
            >
              93 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="2"
            >
              94~106
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="3"
            >
              107~119
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="4"
            >
              120~133
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="5"
            >
              134~146
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="6"
            >
              147~156
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="7"
            >
              157~167
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="8"
            >
              168~178
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="9"
            >
              179~194
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="male"
              data-score="10"
            >
              195 이상
            </td>
            <td class="light-green-bg" id="deadlift-male-score">0</td>
          </tr>
          <tr>
            <td data-gender="female">여</td>
            <td data-gender="female">
              <input
                type="number"
                class="score-input"
                id="deadlift-female-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="1"
            >
              51 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="2"
            >
              52~59
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="3"
            >
              60~67
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="4"
            >
              68~76
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="5"
            >
              77~84
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="6"
            >
              85~91
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="7"
            >
              92~99
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="8"
            >
              100~107
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="9"
            >
              108~114
            </td>
            <td
              class="compact-cell score-cell"
              data-category="deadlift"
              data-gender="female"
              data-score="10"
            >
              115 이상
            </td>
            <td class="light-green-bg" id="deadlift-female-score">0</td>
          </tr>

          <!-- 앉아윗몸앞으로굽히기 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">
              앉아윗몸<br />앞으로굽<br />히기(cm)
            </td>
            <td data-gender="male">남</td>
            <td data-gender="male">
              <input
                type="number"
                class="score-input"
                id="situp-male-input"
                step="0.1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="1"
            >
              1.8 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="2"
            >
              1.9~5.6
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="3"
            >
              5.7~9.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="4"
            >
              9.4~12.9
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="5"
            >
              13.0~16.0
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="6"
            >
              16.1~18.0
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="7"
            >
              18.1~20.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="8"
            >
              20.4~22.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="9"
            >
              22.5~24.2
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="male"
              data-score="10"
            >
              24.3 이상
            </td>
            <td class="light-green-bg" id="situp-male-score">0</td>
          </tr>
          <tr>
            <td data-gender="female">여</td>
            <td data-gender="female">
              <input
                type="number"
                class="score-input"
                id="situp-female-input"
                step="0.1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="1"
            >
              2.5 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="2"
            >
              2.6~7.9
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="3"
            >
              8.0~12.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="4"
            >
              12.5~16.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="5"
            >
              16.4~19.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="6"
            >
              19.5~21.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="7"
            >
              21.4~23.3
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="8"
            >
              23.4~25.4
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="9"
            >
              25.5~26.7
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situp"
              data-gender="female"
              data-score="10"
            >
              26.8 이상
            </td>
            <td class="light-green-bg" id="situp-female-score">0</td>
          </tr>

          <!-- 제자리멀리뛰기 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">
              제자리<br />멀리뛰기<br />(cm)
            </td>
            <td data-gender="male">남</td>
            <td data-gender="male">
              <input
                type="number"
                class="score-input"
                id="broadjump-male-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="1"
            >
              164 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="2"
            >
              165~178
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="3"
            >
              179~192
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="4"
            >
              193~207
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="5"
            >
              208~222
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="6"
            >
              223~230
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="7"
            >
              231~240
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="8"
            >
              241~249
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="9"
            >
              250~257
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="male"
              data-score="10"
            >
              258 이상
            </td>
            <td class="light-green-bg" id="broadjump-male-score">0</td>
          </tr>
          <tr>
            <td data-gender="female">여</td>
            <td data-gender="female">
              <input
                type="number"
                class="score-input"
                id="broadjump-female-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="1"
            >
              107 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="2"
            >
              108~120
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="3"
            >
              121~133
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="4"
            >
              134~146
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="5"
            >
              147~159
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="6"
            >
              160~166
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="7"
            >
              167~175
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="8"
            >
              176~184
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="9"
            >
              185~193
            </td>
            <td
              class="compact-cell score-cell"
              data-category="broadjump"
              data-gender="female"
              data-score="10"
            >
              194 이상
            </td>
            <td class="light-green-bg" id="broadjump-female-score">0</td>
          </tr>

          <!-- 윗몸일으키기 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">
              윗몸일으<br />키기<br />(회/분)
            </td>
            <td data-gender="male">남</td>
            <td data-gender="male">
              <input
                type="number"
                class="score-input"
                id="situps-male-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="1"
            >
              19 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="2"
            >
              20~25
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="3"
            >
              26~31
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="4"
            >
              32~37
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="5"
            >
              38~41
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="6"
            >
              42~45
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="7"
            >
              46~48
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="8"
            >
              49~50
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="9"
            >
              51~53
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="male"
              data-score="10"
            >
              54 이상
            </td>
            <td class="light-green-bg" id="situps-male-score">0</td>
          </tr>
          <tr>
            <td data-gender="female">여</td>
            <td data-gender="female">
              <input
                type="number"
                class="score-input"
                id="situps-female-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="1"
            >
              8 이하
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="2"
            >
              9~14
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="3"
            >
              15~20
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="4"
            >
              21~26
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="5"
            >
              27~31
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="6"
            >
              32~35
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="7"
            >
              36~38
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="8"
            >
              39~40
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="9"
            >
              41~43
            </td>
            <td
              class="compact-cell score-cell"
              data-category="situps"
              data-gender="female"
              data-score="10"
            >
              44 이상
            </td>
            <td class="light-green-bg" id="situps-female-score">0</td>
          </tr>

          <!-- 왕복오래달리기 -->
          <tr>
            <td rowspan="2" class="left-align gray-bg">
              왕복오래<br />달리기<br />(회)
            </td>
            <td rowspan="2">남</td>
            <td rowspan="2" data-gender="male">
              <input
                type="number"
                class="score-input"
                id="shuttlerun-male-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="1"
            >
              12<br />이하
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="2"
            >
              13<br />~<br />18
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="3"
            >
              19<br />~<br />24
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="4"
            >
              25<br />~<br />30
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="5"
            >
              31<br />~<br />35
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="6"
            >
              36<br />~<br />40
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="7"
            >
              41<br />~<br />45
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="8"
            >
              46<br />~<br />49
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="9"
            >
              50<br />~<br />53
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="10"
            >
              54<br />~<br />57
            </td>
            <td class="light-green-bg" id="shuttlerun-male-score" rowspan="2">
              0
            </td>
          </tr>
          <tr>
            <!-- Empty cell for shifting -->
            <!-- Score 11-20 cells for male -->
            <td
              class="compact-cell score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="11"
            >
              58<br />~<br />60
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="12"
            >
              61<br />~<br />63
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="13"
            >
              64<br />~<br />65
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="14"
            >
              66<br />~<br />67
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="15"
            >
              68<br />~<br />69
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="16"
            >
              70<br />~<br />72
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="17"
            >
              73<br />~<br />75
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="18"
            >
              76<br />~<br />79
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="19"
            >
              80<br />~<br />84
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="male"
              data-score="20"
            >
              85<br />이상
            </td>
          </tr>
          <tr>
            <td rowspan="2" class="left-align gray-bg">
              왕복오래<br />달리기<br />(회)
            </td>
            <td rowspan="2">여</td>
            <td rowspan="2" data-gender="female">
              <input
                type="number"
                class="score-input"
                id="shuttlerun-female-input"
                step="1"
              />
            </td>
            <td
              class="compact-cell score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="1"
            >
              6<br />이하
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="2"
            >
              7<br />~<br />10
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="3"
            >
              11<br />~<br />13
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="4"
            >
              14<br />~<br />16
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="5"
            >
              17<br />~<br />19
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="6"
            >
              20<br />~<br />22
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="7"
            >
              23<br />~<br />25
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="8"
            >
              26<br />~<br />28
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="9"
            >
              29<br />~<br />31
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="10"
            >
              32<br />~<br />33
            </td>
            <td class="light-green-bg" id="shuttlerun-female-score" rowspan="2">
              0
            </td>
          </tr>
          <tr>
            <!-- Empty cell for shifting -->
            <!-- Score 11-20 cells for female -->
            <td
              class="compact-cell score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="11"
            >
              34<br />~<br />35
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="12"
            >
              36<br />~<br />37
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="13"
            >
              38<br />~<br />39
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="14"
            >
              40<br />~<br />41
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="15"
            >
              42<br />~<br />43
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="16"
            >
              44<br />~<br />45
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="17"
            >
              46<br />~<br />48
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="18"
            >
              49<br />~<br />51
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="19"
            >
              52<br />~<br />55
            </td>
            <td
              class="compact-cell narrow-col score-cell"
              data-category="shuttlerun"
              data-gender="female"
              data-score="20"
            >
              56<br />이상
            </td>
          </tr>

          <!-- 나이보정 -->
          <tr class="age-row">
            <td class="left-align blue-text" rowspan="2">나이보정</td>
            <td colspan="4" class="compact-cell">31세이하</td>
            <td colspan="4" class="compact-cell">32~54세</td>
            <td colspan="4" class="compact-cell">55세이상</td>
            <td class="light-green-bg" id="age-adjustment" rowspan="2">0.8</td>
          </tr>
          <tr class="age-row">
            <td colspan="4" class="compact-cell">0.8점</td>
            <td colspan="4" class="compact-cell">1세당 0.8점 추가</td>
            <td colspan="4" class="compact-cell">20점</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- QR 코드 모달 -->
    <div id="qr-modal" class="qr-modal">
      <div class="qr-modal-content">
        <span class="qr-close">&times;</span>
        <h3>접속 QR</h3>
        <img src="contactQR.png" style="width: 100%; height: auto" />
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 점수 저장 객체
        const scores = {
          weight: { male: 0, female: 0 },
          deadlift: { male: 0, female: 0 },
          situp: { male: 0, female: 0 },
          broadjump: { male: 0, female: 0 },
          situps: { male: 0, female: 0 },
          shuttlerun: { male: 0, female: 0 },
        };

        // 선택된 셀을 저장하는 객체
        const selectedCells = {
          weight: { male: null, female: null },
          deadlift: { male: null, female: null },
          situp: { male: null, female: null },
          broadjump: { male: null, female: null },
          situps: { male: null, female: null },
          shuttlerun: { male: null, female: null },
        };

        // 현재 선택된 성별
        let selectedGender = "male";

        // 모든 점수 셀 가져오기
        const scoreCells = document.querySelectorAll(".score-cell");

        // 나이 보정 계수
        let ageFactor = 0.8;

        // 생년월일 요소
        const birthYearSelect = document.getElementById("birth-year");

        // 성별 선택 항목
        const genderMaleRadio = document.getElementById("gender-male");
        const genderFemaleRadio = document.getElementById("gender-female");

        // 득점 표시 요소들
        const maleScoreDisplays = document.querySelectorAll(
          '[id$="-male-score"]'
        );
        const femaleScoreDisplays = document.querySelectorAll(
          '[id$="-female-score"]'
        );

        // 배점 셀 텍스트에 자동 줄바꿈 적용
        function formatScoreCellContent() {
          scoreCells.forEach((cell) => {
            const originalText = cell.textContent.trim();

            // 이상/이하 패턴 체크
            if (
              originalText.includes("이상") ||
              originalText.includes("이하")
            ) {
              const parts = originalText.split(" ");
              if (parts.length === 2) {
                const html = `<span class="range-text">${parts[0]}</span><span class="range-text">${parts[1]}</span>`;
                cell.innerHTML = html;
              }
            }
            // 범위(~) 패턴 체크
            else if (originalText.includes("~")) {
              const parts = originalText.split("~");
              if (parts.length === 2) {
                const html = `<span class="range-text">${parts[0]}</span><span class="range-text">~</span><span class="range-text">${parts[1]}</span>`;
                cell.innerHTML = html;
              }
            }
          });
        }

        // 성별에 따른 셀 활성화/비활성화 함수
        function updateCellsActiveState() {
          const scoreInputs = document.querySelectorAll(".score-input");
          // 성별 이름 셀과 기록 입력 셀을 포함한 모든 관련 셀 가져오기
          const genderSpecificTds =
            document.querySelectorAll("td[data-gender]");

          // 점수 셀 활성화/비활성화
          scoreCells.forEach((cell) => {
            const cellGender = cell.dataset.gender;
            if (cellGender === selectedGender) {
              cell.classList.remove("inactive");
            } else {
              cell.classList.add("inactive");
            }
          });

          // 득점 표시 셀 활성화/비활성화
          if (selectedGender === "male") {
            maleScoreDisplays.forEach((el) => el.classList.remove("inactive"));
            femaleScoreDisplays.forEach((el) => el.classList.add("inactive"));
          } else {
            maleScoreDisplays.forEach((el) => el.classList.add("inactive"));
            femaleScoreDisplays.forEach((el) =>
              el.classList.remove("inactive")
            );
          }

          // 기록 입력 필드 활성화/비활성화
          scoreInputs.forEach((input) => {
            const inputId = input.id; // e.g., "weight-male-input"
            let inputGender = null;

            if (inputId.includes("-male-")) {
              inputGender = "male";
            } else if (inputId.includes("-female-")) {
              inputGender = "female";
            }

            if (inputGender === selectedGender) {
              input.disabled = false;
              input.classList.remove("inactive-input");
            } else {
              input.disabled = true;
              input.classList.add("inactive-input");
              // input.value = ''; // 선택되지 않은 성별의 입력값 초기화 (선택 사항)
            }
          });

          // 성별 이름 셀과 기록 입력 셀 활성화/비활성화 (배경색 등)
          genderSpecificTds.forEach((td) => {
            if (td.dataset.gender === selectedGender) {
              td.classList.remove("inactive-td");
            } else {
              td.classList.add("inactive-td");
            }
          });
        }

        // 점수 표시 요소에 클래스 추가
        maleScoreDisplays.forEach((el) => el.classList.add("score-display"));
        femaleScoreDisplays.forEach((el) => el.classList.add("score-display"));

        // 성별 선택 이벤트
        genderMaleRadio.addEventListener("change", function () {
          if (this.checked) {
            selectedGender = "male";
            updateCellsActiveState();
            calculateTotal();
            autoSaveData(); // 자동 저장 추가
          }
        });

        genderFemaleRadio.addEventListener("change", function () {
          if (this.checked) {
            selectedGender = "female";
            updateCellsActiveState();
            calculateTotal();
            autoSaveData(); // 자동 저장 추가
          }
        });

        // 생년월일 변경 이벤트 리스너
        function updateAgeAdjustment() {
          const birthYear = parseInt(birthYearSelect.value);

          // 현재 연도 가져오기
          const today = new Date();
          const currentYear = today.getFullYear();

          // 해당 연도 12월 31일 기준 만 나이 계산
          // 12월 31일 기준이므로 현재 연도 - 태어난 연도로 계산
          let age = currentYear - birthYear;

          // 연령 표시
          document.getElementById("age-display").textContent = age + "세";

          // 나이에 따른 보정 계수 설정
          if (age <= 31) {
            ageFactor = 0.8;
          } else if (age >= 55) {
            ageFactor = 20.0;
          } else {
            ageFactor = (age - 31) * 0.8 + 0.8;
          }

          // 나이 보정 득점 표시 및 배경색 설정
          const ageAdjustmentEl = document.getElementById("age-adjustment");
          ageAdjustmentEl.textContent = ageFactor.toFixed(1);

          // 배경색 변경 (선택된 셀과 같은 색상으로)
          ageAdjustmentEl.style.backgroundColor = "#c8e6c9";

          // 총점 업데이트
          calculateTotal();

          // 버튼 활성화 상태로 변경
          document.getElementById("birth-confirm-btn").classList.add("active");
        }

        // 나이 보정 초기화 함수 수정
        function resetAgeAdjustment() {
          document.getElementById("age-display").textContent = "";

          // 나이 보정 득점 초기화 및 배경색 제거
          const ageAdjustmentEl = document.getElementById("age-adjustment");
          ageAdjustmentEl.textContent = "";
          ageAdjustmentEl.style.backgroundColor = "";

          ageFactor = 0;
          calculateTotal();

          // 버튼 비활성화 상태로 변경
          document
            .getElementById("birth-confirm-btn")
            .classList.remove("active");
        }

        // 생년월일 변경 감지 및 득점 초기화
        birthYearSelect.addEventListener("change", resetAgeAdjustment);

        // 확인 버튼으로 나이 보정 적용
        document
          .getElementById("birth-confirm-btn")
          .addEventListener("click", function () {
            if (this.classList.contains("active")) {
              // 이미 활성화된 상태면 비활성화
              resetAgeAdjustment();
            } else {
              // 비활성화 상태면 활성화
              updateAgeAdjustment();
            }
            // 자동 저장 추가
            autoSaveData();
          });

        // 초기화 버튼 이벤트 수정
        document
          .getElementById("reset-btn")
          .addEventListener("click", function () {
            // 사용자에게 확인 메시지 표시 (필요하다면 이것도 제거 가능)
            if (
              confirm(
                "모든 입력과 저장된 데이터가 삭제됩니다. 계속하시겠습니까?"
              )
            ) {
              // 기록 입력 필드 초기화
              document.querySelectorAll(".score-input").forEach((input) => {
                input.value = "";
              });

              // 모든 점수 초기화
              for (const category in scores) {
                scores[category].male = 0;
                scores[category].female = 0;

                // 득점 표시 초기화 (텍스트와 배경색 모두)
                if (document.getElementById(`${category}-male-score`)) {
                  const maleScoreEl = document.getElementById(
                    `${category}-male-score`
                  );
                  maleScoreEl.textContent = "0";
                  maleScoreEl.style.backgroundColor = ""; // 배경색 초기화
                }

                if (document.getElementById(`${category}-female-score`)) {
                  const femaleScoreEl = document.getElementById(
                    `${category}-female-score`
                  );
                  femaleScoreEl.textContent = "0";
                  femaleScoreEl.style.backgroundColor = ""; // 배경색 초기화
                }
              }

              // 선택된 모든 셀 초기화
              for (const category in selectedCells) {
                if (selectedCells[category].male) {
                  selectedCells[category].male.classList.remove("selected");
                  selectedCells[category].male = null;
                }
                if (selectedCells[category].female) {
                  selectedCells[category].female.classList.remove("selected");
                  selectedCells[category].female = null;
                }
              }

              // 생년월일 기본값으로 설정
              birthYearSelect.value = "";

              // 성별 기본값 설정
              selectedGender = "male";
              genderMaleRadio.checked = true;
              genderFemaleRadio.checked = false;

              // 셀 활성화 상태 업데이트
              updateCellsActiveState();

              // 나이 보정 초기화
              resetAgeAdjustment();

              // 나이 보정 배경색 명시적 초기화
              document.getElementById("age-adjustment").style.backgroundColor =
                "";

              // 총점 초기화
              const totalScoreValueElement =
                document.getElementById("total-score-value");
              const conversionScoreValueElement = document.getElementById(
                "conversion-score-value"
              );
              const totalScoreContainer =
                document.getElementById("total-score");

              totalScoreValueElement.textContent = "0";
              conversionScoreValueElement.textContent = "";
              totalScoreContainer.classList.add("light-yellow-bg");
              totalScoreContainer.classList.remove("yellow-bg");
              totalScoreValueElement.classList.remove("bold-text");

              // localStorage에서 모든 관련 데이터 삭제
              localStorage.removeItem("fitnessTestState");
            }
          });

        // 총점 계산 함수 수정
        function calculateTotal() {
          let subtotal = 0;
          let allScoresEntered = true;

          // 모든 카테고리의 점수 합산 및 모든 점수가 입력되었는지 확인
          for (const category in scores) {
            subtotal += scores[category][selectedGender];

            // 득점이 0이면 모든 점수가 입력되지 않은 것으로 판단
            if (scores[category][selectedGender] === 0) {
              allScoresEntered = false;
            }
          }

          // 나이 보정 적용
          let total = subtotal + ageFactor;

          // 총점 70점 제한
          if (total > 70) {
            total = 70;
          }

          // 총점 및 환산점 표시
          const totalScoreValueElement =
            document.getElementById("total-score-value");
          const conversionScoreValueElement = document.getElementById(
            "conversion-score-value"
          );
          const totalScoreContainer = document.getElementById("total-score");

          totalScoreValueElement.textContent = total.toFixed(1);

          // 환산점 계산 및 표시 (총점 / 14, 모든 항목이 채워진 경우에만)
          if (allScoresEntered && ageFactor > 0) {
            const conversionScore = Math.round((total / 14) * 100) / 100; // 총점 / 14, 소수점 2자리까지

            // 괄호 제거하고 값만 표시
            conversionScoreValueElement.textContent =
              conversionScore.toFixed(2);

            totalScoreContainer.classList.remove("light-yellow-bg");
            totalScoreContainer.classList.add("yellow-bg");
            totalScoreValueElement.classList.add("bold-text");
          } else {
            conversionScoreValueElement.textContent = "";

            totalScoreContainer.classList.add("light-yellow-bg");
            totalScoreContainer.classList.remove("yellow-bg");
            totalScoreValueElement.classList.remove("bold-text");
          }
        }

        // 점수 셀 클릭 이벤트 처리
        scoreCells.forEach((cell) => {
          cell.addEventListener("click", function () {
            const category = this.dataset.category;
            const gender = this.dataset.gender;
            const score = parseInt(this.dataset.score);

            // 비활성화된 셀(다른 성별)은 클릭 무시
            if (gender !== selectedGender) {
              return;
            }

            // 득점 표시 셀 찾기
            const scoreDisplayCell = document.getElementById(
              `${category}-${gender}-score`
            );

            // 이미 선택된 셀인 경우 선택 해제
            if (selectedCells[category][gender] === this) {
              this.classList.remove("selected");
              selectedCells[category][gender] = null;
              scores[category][gender] = 0;
              scoreDisplayCell.textContent = "0";
              scoreDisplayCell.style.backgroundColor = ""; // 배경색 초기화
            } else {
              // 이전에 선택된 셀이 있으면 선택 해제
              if (selectedCells[category][gender]) {
                selectedCells[category][gender].classList.remove("selected");
              }

              // 새 셀 선택
              this.classList.add("selected");
              selectedCells[category][gender] = this;
              scores[category][gender] = score;
              scoreDisplayCell.textContent = score;

              // 우측 득점 셀 배경색을 선택된 셀과 동일하게 변경
              scoreDisplayCell.style.backgroundColor =
                getComputedStyle(this).backgroundColor;
            }

            // 총점 업데이트
            calculateTotal();

            // 변경사항 자동 저장
            autoSaveData();
          });
        });

        // 배점 셀 텍스트 포맷팅 적용
        formatScoreCellContent();

        // 초기 셀 활성화 상태 설정
        updateCellsActiveState();

        // 초기 나이 보정 상태 설정 (버튼 비활성화)
        resetAgeAdjustment();

        // 자동 저장 함수에 나이 보정 배경색도 포함되도록 수정
        function autoSaveData() {
          // 입력 필드 값 수집
          const inputValues = {};
          document.querySelectorAll(".score-input").forEach((input) => {
            if (input.value.trim() !== "") {
              inputValues[input.id] = input.value;
            }
          });

          // 득점 셀 배경색 정보 수집
          const scoreDisplayColors = {};
          document.querySelectorAll(".score-display").forEach((display) => {
            if (display.style.backgroundColor) {
              scoreDisplayColors[display.id] = display.style.backgroundColor;
            }
          });

          // 나이 보정 배경색 추가
          const ageAdjustmentEl = document.getElementById("age-adjustment");
          if (ageAdjustmentEl && ageAdjustmentEl.style.backgroundColor) {
            scoreDisplayColors["age-adjustment"] =
              ageAdjustmentEl.style.backgroundColor;
          }

          // 용도 정보 추가 (안전하게 확인)
          let usageType = "personal"; // 기본값
          const usageTypeEl = document.getElementById("usage-type");
          if (usageTypeEl) {
            usageType = usageTypeEl.value;
          }

          // 현재 상태를 localStorage에 저장
          const savedState = {
            scores: scores,
            selectedGender: selectedGender,
            birthYear: birthYearSelect.value,
            ageConfirmed: document
              .getElementById("birth-confirm-btn")
              .classList.contains("active"),
            inputValues: inputValues,
            scoreDisplayColors: scoreDisplayColors,
            usageType: usageType,
          };

          localStorage.setItem("fitnessTestState", JSON.stringify(savedState));

          // 디버깅용 콘솔 로그 (나중에 제거 가능)
          console.log("자동 저장 완료:", new Date().toLocaleTimeString());
        }

        // 기록 입력 변경 핸들러 수정
        function handleRecordInputChange(event) {
          const input = event.target;
          const inputValue = input.value.trim();
          const category = input.id.split("-")[0]; // e.g., 'weight' from 'weight-male-input'
          const gender = input.id.includes("-male-") ? "male" : "female";

          let matchedCell = null;
          const numericValue = parseFloat(inputValue);

          if (inputValue === "" || isNaN(numericValue)) {
            // 입력값이 비었거나 숫자가 아니면 현재 선택된 셀 해제
            if (selectedCells[category] && selectedCells[category][gender]) {
              selectedCells[category][gender].click(); // 기존 클릭 핸들러로 해제
            }
            // 자동 저장
            autoSaveData();
            return; // 처리 중단
          }

          // 해당 카테고리와 성별의 모든 점수 셀 순회
          const relevantCells = document.querySelectorAll(
            `.score-cell[data-category="${category}"][data-gender="${gender}"]`
          );

          relevantCells.forEach((cell) => {
            const range = parseScoreRange(cell.textContent);
            if (numericValue >= range.min && numericValue <= range.max) {
              matchedCell = cell;
            }
          });

          // 일치하는 셀을 찾았는지 확인
          if (matchedCell) {
            // 현재 선택된 셀과 다른 경우에만 클릭 이벤트 트리거
            if (
              !(
                selectedCells[category] &&
                selectedCells[category][gender] === matchedCell
              )
            ) {
              matchedCell.click(); // 이미 autoSaveData()가 여기서 호출됨
            }
          } else {
            // 일치하는 셀이 없으면 현재 선택된 셀 해제
            if (selectedCells[category] && selectedCells[category][gender]) {
              selectedCells[category][gender].click(); // 이미 autoSaveData()가 여기서 호출됨
            } else {
              // 이미 선택된 셀이 없는 경우에는 수동으로 자동 저장 호출
              autoSaveData();
            }
          }
        }

        // 모든 기록 입력 필드에 이벤트 리스너 재설정
        const allScoreInputs = document.querySelectorAll(".score-input");
        allScoreInputs.forEach((input) => {
          // 이전 이벤트 리스너 제거 (중복 방지)
          input.removeEventListener("input", handleRecordInputChange);
          // 새 이벤트 리스너 추가
          input.addEventListener("input", function (event) {
            handleRecordInputChange(event);
            // 자동 저장 명시적 호출
            autoSaveData();
          });
        });

        // 페이지 로드 시 저장된 데이터가 있는지 확인
        const savedData = localStorage.getItem("fitnessTestState");
        if (savedData) {
          try {
            const savedState = JSON.parse(savedData);

            // 성별 복원
            if (savedState.selectedGender) {
              selectedGender = savedState.selectedGender;
              if (selectedGender === "male") {
                genderMaleRadio.checked = true;
                genderFemaleRadio.checked = false;
              } else {
                genderMaleRadio.checked = false;
                genderFemaleRadio.checked = true;
              }
            }

            // 출생년도 복원
            if (savedState.birthYear) {
              birthYearSelect.value = savedState.birthYear;
              // 생년 확인 버튼 상태 복원 (저장된 상태가 confirmed일 때만 활성화)
              if (savedState.ageConfirmed) {
                updateAgeAdjustment();
              } else {
                // 명시적으로 저장되지 않았거나 false면 비활성화 상태 유지
                resetAgeAdjustment();
              }
            }

            // 점수 복원
            if (savedState.scores) {
              for (const category in savedState.scores) {
                if (scores.hasOwnProperty(category)) {
                  scores[category] = savedState.scores[category];

                  // 점수 표시 업데이트
                  if (scores[category].male > 0) {
                    document.getElementById(
                      `${category}-male-score`
                    ).textContent = scores[category].male;
                  }

                  if (scores[category].female > 0) {
                    document.getElementById(
                      `${category}-female-score`
                    ).textContent = scores[category].female;
                  }
                }
              }

              // 선택된 셀 시각적 업데이트
              scoreCells.forEach((cell) => {
                const category = cell.dataset.category;
                const gender = cell.dataset.gender;
                const score = parseInt(cell.dataset.score);

                if (scores[category][gender] === score) {
                  cell.classList.add("selected");
                  selectedCells[category][gender] = cell;
                }
              });
            }

            // 득점 셀 배경색 복원
            if (savedState.scoreDisplayColors) {
              for (const displayId in savedState.scoreDisplayColors) {
                const displayEl = document.getElementById(displayId);
                if (displayEl) {
                  displayEl.style.backgroundColor =
                    savedState.scoreDisplayColors[displayId];
                }
              }
            }

            // 입력 필드 값 복원
            if (savedState.inputValues) {
              for (const inputId in savedState.inputValues) {
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                  inputElement.value = savedState.inputValues[inputId];
                }
              }
            }

            // 셀 활성화 상태 및 총점 업데이트
            updateCellsActiveState();
            calculateTotal();

            // 사용 유형 복원
            if (savedState.usageType) {
              document.getElementById("usage-type").value =
                savedState.usageType;
            }

            // 나이 보정 맨 우측 득점 셀 복원
            const rightScoreAdjustment = document.getElementById(
              "right-score-adjustment"
            );
            if (rightScoreAdjustment && savedState.rightScoreAdjustment) {
              rightScoreAdjustment.textContent =
                savedState.rightScoreAdjustment;
            }

            // 나이 보정 값 복원
            const ageAdjustmentEl = document.getElementById("age-adjustment");
            if (ageAdjustmentEl && savedState.ageAdjustment) {
              ageAdjustmentEl.textContent = savedState.ageAdjustment;
            }

            // 나이 보정 배경색 복원
            if (
              savedState.scoreDisplayColors &&
              savedState.scoreDisplayColors["age-adjustment"]
            ) {
              ageAdjustmentEl.style.backgroundColor =
                savedState.scoreDisplayColors["age-adjustment"];
            }

            // 총점과 환산점 명시적 복원
            if (savedState.totalScore) {
              document.getElementById("total-score-value").textContent =
                savedState.totalScore;
            }

            if (savedState.conversionScore) {
              document.getElementById("conversion-score-value").textContent =
                savedState.conversionScore;
            }
          } catch (e) {
            console.error("저장된 데이터 복원 중 오류가 발생했습니다.", e);
            // 오류 발생 시에도 기본적으로 버튼 비활성화
            resetAgeAdjustment();
          }
        } else {
          // 저장된 데이터가 없을 경우에도 버튼 비활성화
          resetAgeAdjustment();
        }

        // QR 버튼 이벤트
        document
          .getElementById("qr-btn")
          .addEventListener("click", function () {
            const modal = document.getElementById("qr-modal");
            modal.style.display = "block";
          });

        // 모달 닫기
        document
          .querySelector(".qr-close")
          .addEventListener("click", function () {
            const modal = document.getElementById("qr-modal");
            modal.style.display = "none";
          });

        // 모달 외부 클릭 시 닫기
        window.addEventListener("click", function (event) {
          const modal = document.getElementById("qr-modal");
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });

        // 점수 범위 파싱 함수
        function parseScoreRange(text) {
          const cleanedText = text.replace(/<br\s*\/?>/gi, "").trim(); // <br> 태그 제거 및 공백 제거
          let min = -Infinity,
            max = Infinity;

          if (cleanedText.includes("이상")) {
            min = parseFloat(cleanedText.replace(" 이상", ""));
          } else if (cleanedText.includes("이하")) {
            max = parseFloat(cleanedText.replace(" 이하", ""));
          } else if (cleanedText.includes("~")) {
            const parts = cleanedText.split("~");
            if (parts.length === 2) {
              min = parseFloat(parts[0]);
              max = parseFloat(parts[1]);
            }
          } else {
            // 단일 값 처리 (필요한 경우)
            const val = parseFloat(cleanedText);
            if (!isNaN(val)) {
              min = val;
              max = val;
            }
          }
          return { min, max };
        }

        // 드롭다운 상태 저장/불러오기 함수 추가
        document
          .getElementById("usage-type")
          .addEventListener("change", function () {
            // 상태 저장
            localStorage.setItem("fitnessTestUsageType", this.value);

            // 자동 저장 함수 호출 (기존 상태 저장에 용도 정보 추가)
            autoSaveData();
          });

        // 페이지 로드 시 저장된 용도 정보 불러오기
        window.addEventListener("DOMContentLoaded", function () {
          // 저장된 사용 유형 불러오기
          const savedUsageType = localStorage.getItem("fitnessTestUsageType");
          if (savedUsageType) {
            document.getElementById("usage-type").value = savedUsageType;
          }

          // 기존 코드 ...
        });
      });
    </script>
  </body>
</html>
